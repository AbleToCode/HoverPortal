<Window x:Class="HoverPortal.Views.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:HoverPortal.ViewModels"
        mc:Ignorable="d"
        Title="设置"
        Height="640" Width="480"
        WindowStartupLocation="CenterOwner"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        ResizeMode="NoResize"
        ShowInTaskbar="False">

    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Resources/SettingsStyles.xaml"/>
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </Window.Resources>

    <!-- Main Container with Shadow -->
    <Border Background="{StaticResource BackgroundBrush}"
            CornerRadius="12"
            Margin="16">
        <Border.Effect>
            <DropShadowEffect Color="#40000000" 
                              BlurRadius="32" 
                              ShadowDepth="8"
                              Direction="270"/>
        </Border.Effect>
        
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- ========== Header ========== -->
            <Border Grid.Row="0" 
                    Padding="24,20"
                    Background="{StaticResource BackgroundBrush}"
                    CornerRadius="12,12,0,0"
                    BorderBrush="{StaticResource SeparatorBrush}"
                    BorderThickness="0,0,0,1"
                    MouseLeftButtonDown="Header_MouseLeftButtonDown">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- Title -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal">
                        <TextBlock Text="⚙️" FontSize="24" VerticalAlignment="Center" Margin="0,0,12,0"/>
                        <TextBlock Text="设置" 
                                   FontFamily="{StaticResource PrimaryFont}"
                                   FontSize="24"
                                   FontWeight="SemiBold"
                                   Foreground="{StaticResource PrimaryTextBrush}"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                    
                    <!-- Close Button -->
                    <Button Grid.Column="1" 
                            Style="{StaticResource CloseButton}"
                            Click="CloseButton_Click"/>
                </Grid>
            </Border>

            <!-- ========== Content ScrollViewer ========== -->
            <ScrollViewer Grid.Row="1" 
                          VerticalScrollBarVisibility="Auto"
                          HorizontalScrollBarVisibility="Disabled"
                          Padding="24,16">
                <StackPanel>
                    
                    <!-- ===== 通用设置 Section ===== -->
                    <TextBlock Text="通用" Style="{StaticResource SectionTitle}"/>
                    <Border Style="{StaticResource SectionCard}">
                        <StackPanel>
                            <!-- 开机启动 -->
                            <Grid Margin="0,0,0,16">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="开机自动启动" Style="{StaticResource SettingLabel}"/>
                                    <TextBlock Text="登录 Windows 时自动运行" Style="{StaticResource SettingDescription}"/>
                                </StackPanel>
                                <CheckBox Grid.Column="1" 
                                          Style="{StaticResource AppleToggleSwitch}"
                                          IsChecked="{Binding Settings.LaunchAtStartup}"
                                          VerticalAlignment="Center"/>
                            </Grid>
                            
                            <!-- 最小化到托盘 -->
                            <Grid Margin="0,0,0,16">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="最小化到托盘" Style="{StaticResource SettingLabel}"/>
                                    <TextBlock Text="关闭窗口时保持后台运行" Style="{StaticResource SettingDescription}"/>
                                </StackPanel>
                                <CheckBox Grid.Column="1" 
                                          Style="{StaticResource AppleToggleSwitch}"
                                          IsChecked="{Binding Settings.MinimizeToTray}"
                                          VerticalAlignment="Center"/>
                            </Grid>
                            
                            <!-- 自动检查更新 -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="自动检查更新" Style="{StaticResource SettingLabel}"/>
                                    <TextBlock Text="定期检查新版本" Style="{StaticResource SettingDescription}"/>
                                </StackPanel>
                                <CheckBox Grid.Column="1" 
                                          Style="{StaticResource AppleToggleSwitch}"
                                          IsChecked="{Binding Settings.CheckForUpdates}"
                                          VerticalAlignment="Center"/>
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- ===== 行为设置 Section ===== -->
                    <TextBlock Text="行为" Style="{StaticResource SectionTitle}"/>
                    <Border Style="{StaticResource SectionCard}">
                        <StackPanel>
                            <!-- 悬停延迟 -->
                            <Grid Margin="0,0,0,20">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Row="0" Grid.Column="0">
                                    <TextBlock Text="悬停延迟" Style="{StaticResource SettingLabel}"/>
                                    <TextBlock Text="鼠标悬停多久后触发预览" Style="{StaticResource SettingDescription}"/>
                                </StackPanel>
                                <TextBlock Grid.Row="0" Grid.Column="1"
                                           Text="{Binding Settings.HoverDelayMs, StringFormat={}{0} ms}"
                                           FontFamily="{StaticResource PrimaryFont}"
                                           FontSize="14"
                                           FontWeight="Medium"
                                           Foreground="{StaticResource AccentBrush}"
                                           VerticalAlignment="Center"/>
                                <Slider Grid.Row="1" Grid.ColumnSpan="2"
                                        Style="{StaticResource AppleSlider}"
                                        Minimum="100" Maximum="1000"
                                        Value="{Binding Settings.HoverDelayMs}"
                                        TickFrequency="50"
                                        IsSnapToTickEnabled="True"
                                        Margin="0,12,0,0"/>
                            </Grid>
                            
                            <!-- 动画预设 -->
                            <Grid Margin="0,0,0,16">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="140"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="动画预设" Style="{StaticResource SettingLabel}"/>
                                    <TextBlock Text="预览窗口的动画速度" Style="{StaticResource SettingDescription}"/>
                                </StackPanel>
                                <ComboBox Grid.Column="1"
                                          Style="{StaticResource AppleComboBox}"
                                          ItemsSource="{Binding AnimationPresetOptions}"
                                          SelectedValue="{Binding Settings.AnimationPreset}"
                                          SelectedValuePath="Value"
                                          DisplayMemberPath="DisplayName"
                                          VerticalAlignment="Center"/>
                            </Grid>
                            
                            <!-- 全屏时显示 -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="全屏模式下显示" Style="{StaticResource SettingLabel}"/>
                                    <TextBlock Text="在全屏游戏或应用中仍显示预览" Style="{StaticResource SettingDescription}"/>
                                </StackPanel>
                                <CheckBox Grid.Column="1" 
                                          Style="{StaticResource AppleToggleSwitch}"
                                          IsChecked="{Binding Settings.ShowInFullscreenApps}"
                                          VerticalAlignment="Center"/>
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- ===== 外观设置 Section ===== -->
                    <TextBlock Text="外观" Style="{StaticResource SectionTitle}"/>
                    <Border Style="{StaticResource SectionCard}">
                        <StackPanel>
                            <!-- 圆角大小 -->
                            <Grid Margin="0,0,0,20">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Row="0" Grid.Column="0">
                                    <TextBlock Text="圆角大小" Style="{StaticResource SettingLabel}"/>
                                    <TextBlock Text="预览窗口边角的圆润程度" Style="{StaticResource SettingDescription}"/>
                                </StackPanel>
                                <TextBlock Grid.Row="0" Grid.Column="1"
                                           Text="{Binding Settings.CornerRadius, StringFormat={}{0} px}"
                                           FontFamily="{StaticResource PrimaryFont}"
                                           FontSize="14"
                                           FontWeight="Medium"
                                           Foreground="{StaticResource AccentBrush}"
                                           VerticalAlignment="Center"/>
                                <Slider Grid.Row="1" Grid.ColumnSpan="2"
                                        Style="{StaticResource AppleSlider}"
                                        Minimum="0" Maximum="24"
                                        Value="{Binding Settings.CornerRadius}"
                                        TickFrequency="2"
                                        IsSnapToTickEnabled="True"
                                        Margin="0,12,0,0"/>
                            </Grid>
                            
                            <!-- 窗口透明度 -->
                            <Grid Margin="0,0,0,20">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Row="0" Grid.Column="0">
                                    <TextBlock Text="窗口透明度" Style="{StaticResource SettingLabel}"/>
                                    <TextBlock Text="预览窗口的背景透明度" Style="{StaticResource SettingDescription}"/>
                                </StackPanel>
                                <TextBlock Grid.Row="0" Grid.Column="1"
                                           Text="{Binding Settings.WindowOpacity, StringFormat={}{0}%}"
                                           FontFamily="{StaticResource PrimaryFont}"
                                           FontSize="14"
                                           FontWeight="Medium"
                                           Foreground="{StaticResource AccentBrush}"
                                           VerticalAlignment="Center"/>
                                <Slider Grid.Row="1" Grid.ColumnSpan="2"
                                        Style="{StaticResource AppleSlider}"
                                        Minimum="70" Maximum="100"
                                        Value="{Binding Settings.WindowOpacity}"
                                        TickFrequency="5"
                                        IsSnapToTickEnabled="True"
                                        Margin="0,12,0,0"/>
                            </Grid>
                            
                            <!-- 模糊效果 -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="模糊背景效果" Style="{StaticResource SettingLabel}"/>
                                    <TextBlock Text="启用 Acrylic/Mica 毛玻璃效果" Style="{StaticResource SettingDescription}"/>
                                </StackPanel>
                                <CheckBox Grid.Column="1" 
                                          Style="{StaticResource AppleToggleSwitch}"
                                          IsChecked="{Binding Settings.EnableBlurEffect}"
                                          VerticalAlignment="Center"/>
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- ===== 关于 Section ===== -->
                    <TextBlock Text="关于" Style="{StaticResource SectionTitle}"/>
                    <Border Style="{StaticResource SectionCard}">
                        <StackPanel>
                            <Grid Margin="0,0,0,12">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="版本" Style="{StaticResource SettingLabel}"/>
                                <TextBlock Grid.Column="1" 
                                           Text="1.0.0"
                                           FontFamily="{StaticResource PrimaryFont}"
                                           FontSize="14"
                                           Foreground="{StaticResource SecondaryTextBrush}"/>
                            </Grid>
                            <Button Content="打开配置文件夹" 
                                    Style="{StaticResource AppleSecondaryButton}"
                                    Command="{Binding OpenConfigFolderCommand}"
                                    HorizontalAlignment="Left"/>
                        </StackPanel>
                    </Border>
                    
                </StackPanel>
            </ScrollViewer>

            <!-- ========== Footer ========== -->
            <Border Grid.Row="2" 
                    Padding="24,16"
                    BorderBrush="{StaticResource SeparatorBrush}"
                    BorderThickness="0,1,0,0">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- Reset Button -->
                    <Button Grid.Column="0"
                            Content="重置默认"
                            Style="{StaticResource AppleSecondaryButton}"
                            Command="{Binding ResetToDefaultsCommand}"/>
                    
                    <!-- Status Message -->
                    <TextBlock Grid.Column="1"
                               Text="{Binding StatusMessage}"
                               FontFamily="{StaticResource PrimaryFont}"
                               FontSize="13"
                               Foreground="{StaticResource SecondaryTextBrush}"
                               VerticalAlignment="Center"
                               HorizontalAlignment="Center"/>
                    
                    <!-- Cancel Button -->
                    <Button Grid.Column="2"
                            Content="取消"
                            Style="{StaticResource AppleSecondaryButton}"
                            Command="{Binding CancelCommand}"
                            Margin="0,0,12,0"/>
                    
                    <!-- Save Button -->
                    <Button Grid.Column="3"
                            Content="保存设置"
                            Style="{StaticResource ApplePrimaryButton}"
                            Command="{Binding SaveCommand}"/>
                </Grid>
            </Border>

            <!-- Loading Overlay -->
            <Border Grid.RowSpan="3"
                    Background="#80FFFFFF"
                    Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibility}}"
                    CornerRadius="12">
                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                    <TextBlock Text="⏳" FontSize="32" HorizontalAlignment="Center"/>
                    <TextBlock Text="请稍候..."
                               FontFamily="{StaticResource PrimaryFont}"
                               FontSize="14"
                               Foreground="{StaticResource SecondaryTextBrush}"
                               Margin="0,8,0,0"/>
                </StackPanel>
            </Border>
        </Grid>
    </Border>
</Window>
